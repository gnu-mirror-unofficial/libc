<html lang="en">
<head>
<title>The GNU C Library</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name=description content="The GNU C Library">
<meta name=generator content="makeinfo 4.2">
<link href="http://www.gnu.org/software/texinfo/" rel=generator-home>
</head>
<body>
<p>
Node:<a name="Printf%20Extension%20Example">Printf Extension Example</a>,
Next:<a rel=next accesskey=n href="Predefined-Printf-Handlers.html#Predefined%20Printf%20Handlers">Predefined Printf Handlers</a>,
Previous:<a rel=previous accesskey=p href="Defining-the-Output-Handler.html#Defining%20the%20Output%20Handler">Defining the Output Handler</a>,
Up:<a rel=up accesskey=u href="Customizing-Printf.html#Customizing%20Printf">Customizing Printf</a>
<hr><br>

<h4><code>printf</code> Extension Example</h4>

<p>Here is an example showing how to define a <code>printf</code> handler function. 
This program defines a data structure called a <code>Widget</code> and
defines the <code>%W</code> conversion to print information about <code>Widget&nbsp;*</code>
arguments, including the pointer value and the name stored in the data
structure.  The <code>%W</code> conversion supports the minimum field width and
left-justification options, but ignores everything else.

<br><pre>

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;printf.h&gt;

typedef struct
{
  char *name;
}
Widget;

int
print_widget (FILE *stream,
              const struct printf_info *info,
              const void *const *args)
{
  const Widget *w;
  char *buffer;
  int len;

  /* Format the output into a string. */
  w = *((const Widget **) (args[0]));
  len = asprintf (&amp;buffer, "&lt;Widget %p: %s&gt;", w, w-&gt;name);
  if (len == -1)
    return -1;

  /* Pad to the minimum field width and print to the stream. */
  len = fprintf (stream, "%*s",
                 (info-&gt;left ? -info-&gt;width : info-&gt;width),
                 buffer);

  /* Clean up and return. */
  free (buffer);
  return len;
}


int
print_widget_arginfo (const struct printf_info *info, size_t n,
                      int *argtypes)
{
  /* We always take exactly one argument and this is a pointer to the
     structure.. */
  if (n &gt; 0)
    argtypes[0] = PA_POINTER;
  return 1;
}


int
main (void)
{
  /* Make a widget to print. */
  Widget mywidget;
  mywidget.name = "mywidget";

  /* Register the print function for widgets. */
  register_printf_function ('W', print_widget, print_widget_arginfo);

  /* Now print the widget. */
  printf ("|%W|\n", &amp;mywidget);
  printf ("|%35W|\n", &amp;mywidget);
  printf ("|%-35W|\n", &amp;mywidget);

  return 0;
}
</pre>

<p>The output produced by this program looks like:

<br><pre>|&lt;Widget 0xffeffb7c: mywidget&gt;|
|      &lt;Widget 0xffeffb7c: mywidget&gt;|
|&lt;Widget 0xffeffb7c: mywidget&gt;      |
</pre>

</body></html>

