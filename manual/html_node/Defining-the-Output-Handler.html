<html lang="en">
<head>
<title>The GNU C Library</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU C Library">
<meta name="generator" content="makeinfo 4.6">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
--></style>
</head>
<body>
<div class="node">
<p>
Node:&nbsp;<a name="Defining%20the%20Output%20Handler">Defining the Output Handler</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="Printf-Extension-Example.html#Printf%20Extension%20Example">Printf Extension Example</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Conversion-Specifier-Options.html#Conversion%20Specifier%20Options">Conversion Specifier Options</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Customizing-Printf.html#Customizing%20Printf">Customizing Printf</a>
<hr><br>
</div>

<h3 class="subsection">Defining the Output Handler</h4>

<p>Now let's look at how to define the handler and arginfo functions
which are passed as arguments to <code>register_printf_function</code>.

   <p><strong>Compatibility Note:</strong> The interface changed in GNU libc
version 2.0.  Previously the third argument was of type
<code>va_list *</code>.

   <p>You should define your handler functions with a prototype like:

<pre class="smallexample">     int <var>function</var> (FILE *stream, const struct printf_info *info,
                         const void *const *args)
     </pre>

   <p>The <var>stream</var> argument passed to the handler function is the stream to
which it should write output.

   <p>The <var>info</var> argument is a pointer to a structure that contains
information about the various options that were included with the
conversion in the template string.  You should not modify this structure
inside your handler function.  See <a href="Conversion-Specifier-Options.html#Conversion%20Specifier%20Options">Conversion Specifier Options</a>, for
a description of this data structure.

   <p>The <var>args</var> is a vector of pointers to the arguments data. 
The number of arguments was determined by calling the argument
information function provided by the user.

   <p>Your handler function should return a value just like <code>printf</code>
does: it should return the number of characters it has written, or a
negative value to indicate an error.

<p>
<table width="100%">
<tr>
<td align="left"><b>printf_function</b><i>
     </i></td>
<td align="right">Data Type</td>
</tr>
</table>
<table width="95%" align="center">
<tr><td>
This is the data type that a handler function should have. 
</td></tr>
</table>

   <p>If you are going to use <code>parse_printf_format</code> in your
application, you must also define a function to pass as the
<var>arginfo-function</var> argument for each new conversion you install with
<code>register_printf_function</code>.

   <p>You have to define these functions with a prototype like:

<pre class="smallexample">     int <var>function</var> (const struct printf_info *info,
                         size_t n, int *argtypes)
     </pre>

   <p>The return value from the function should be the number of arguments the
conversion expects.  The function should also fill in no more than
<var>n</var> elements of the <var>argtypes</var> array with information about the
types of each of these arguments.  This information is encoded using the
various <code>PA_</code> macros.  (You will notice that this is the same
calling convention <code>parse_printf_format</code> itself uses.)

<p>
<table width="100%">
<tr>
<td align="left"><b>printf_arginfo_function</b><i>
     </i></td>
<td align="right">Data Type</td>
</tr>
</table>
<table width="95%" align="center">
<tr><td>
This type is used to describe functions that return information about
the number and type of arguments used by a conversion specifier. 
</td></tr>
</table>

   </body></html>

