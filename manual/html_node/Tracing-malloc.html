<html lang="en">
<head>
<title>The GNU C Library</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name=description content="The GNU C Library">
<meta name=generator content="makeinfo 4.2">
<link href="http://www.gnu.org/software/texinfo/" rel=generator-home>
</head>
<body>
<p>
Node:<a name="Tracing%20malloc">Tracing malloc</a>,
Next:<a rel=next accesskey=n href="Using-the-Memory-Debugger.html#Using%20the%20Memory%20Debugger">Using the Memory Debugger</a>,
Up:<a rel=up accesskey=u href="Allocation-Debugging.html#Allocation%20Debugging">Allocation Debugging</a>
<hr><br>

<h5>How to install the tracing functionality</h5>

<p>
<table width="100%">
<tr>
<td align="left">void <b>mtrace</b><i> (void)
</i></td>
<td align="right">Function</td>
</tr>
</table>
<table width="95%" align="center">
<tr><td>
When the <code>mtrace</code> function is called it looks for an environment
variable named <code>MALLOC_TRACE</code>.  This variable is supposed to
contain a valid file name.  The user must have write access.  If the
file already exists it is truncated.  If the environment variable is not
set or it does not name a valid file which can be opened for writing
nothing is done.  The behavior of <code>malloc</code> etc. is not changed. 
For obvious reasons this also happens if the application is installed
with the SUID or SGID bit set.

<p>If the named file is successfully opened, <code>mtrace</code> installs special
handlers for the functions <code>malloc</code>, <code>realloc</code>, and
<code>free</code> (see <a href="Hooks-for-Malloc.html#Hooks%20for%20Malloc">Hooks for Malloc</a>).  From then on, all uses of these
functions are traced and protocolled into the file.  There is now of
course a speed penalty for all calls to the traced functions so tracing
should not be enabled during normal use.

<p>This function is a GNU extension and generally not available on other
systems.  The prototype can be found in <code>mcheck.h</code>. 
</td></tr>
</table>

<p>
<table width="100%">
<tr>
<td align="left">void <b>muntrace</b><i> (void)
</i></td>
<td align="right">Function</td>
</tr>
</table>
<table width="95%" align="center">
<tr><td>
The <code>muntrace</code> function can be called after <code>mtrace</code> was used
to enable tracing the <code>malloc</code> calls.  If no (successful) call of
<code>mtrace</code> was made <code>muntrace</code> does nothing.

<p>Otherwise it deinstalls the handlers for <code>malloc</code>, <code>realloc</code>,
and <code>free</code> and then closes the protocol file.  No calls are
protocolled anymore and the program runs again at full speed.

<p>This function is a GNU extension and generally not available on other
systems.  The prototype can be found in <code>mcheck.h</code>. 
</td></tr>
</table>

</body></html>

